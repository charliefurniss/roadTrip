<!DOCTYPE html>
<html ng-app="roadTrip">
<head>
  <title>RoadTrip</title>
  <!-- External Files -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.2/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.2/angular-messages.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.15/angular-ui-router.js"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/auth0/angular-jwt/master/dist/angular-jwt.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-resource.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  

  <!-- Internal Files -->
  <script src="./js/app.js"></script>
  <script src="./js/services/tokenService.js"></script>
  <script src="./js/services/authInterceptor.js"></script>
  <script src="./js/services/currentUser.js"></script>
  <script src="./js/models/userFactory.js"></script>
  <script src="./js/models/tripFactory.js"></script>
  <script src="./js/controllers/usersController.js"></script>
  <script src="./js/controllers/tripsController.js"></script>

  <script type="text/javascript">
    
    var map;
    var service;

    function handleSearchResults(results, status) {

      console.log(results);

      for(i = 0; i < results.length; i++){
        //create a marker for each result
        createMarker(results[i].geometry.location, results[i].name);
      }
    }

    function performSearch(currentLocation) {
      // sets variables used in search request
      var request = {
          location: currentLocation,
          radius: '500',
          types: ['hotel']
        };
      //performs the search on the service object. nearbySearch is a function of GM Places. request passes in the search criteria 
      service.nearbySearch(request, handleSearchResults);
    }

    function createMarker(location, title){
      var marker = new google.maps.Marker({
        position: location,
        map: map,
        title: title
      });
    }

    function initialise(location) {
      var trafficLayer = new google.maps.TrafficLayer();

      function addTrafficLayer(map) {
        trafficLayer.setMap(map);
      }

      var currentLocation = {lat: location.coords.latitude, lng: location.coords.longitude};

      //creates map and sets its properties
      map = new google.maps.Map(document.getElementById('map-canvas'), {
        center: currentLocation,
        zoom: 12,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      });

      // sets marker at the stated position
      createMarker(currentLocation, "Title");

      // create a new GM places object based on the  PlacesService class and pass it a reference to our GM object
      service = new google.maps.places.PlacesService(map)

      addTrafficLayer(map);

      performSearch(currentLocation);    

    }

    $(document).ready(function(){

    // Get user's current position using HTML5 geolocation feature. navigator object has property called geolocation. We pass it the initialise function for it to call when it has go the location
    navigator.geolocation.getCurrentPosition(initialise);

  });
  </script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMF1USMrYbIs6U4XjyEhpdap31gZMqlxA&libraries=places"></script>

  <!-- Stylesheets -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="./css/style.css">
</head>
<body ng-controller="UsersController as users">
  <div ng-controller="TripsController as trips">

  <header>
    <nav class="navbar navbar-default">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#" ui-sref-active="active" ui-sref="home">RoadTrip</a>
          <ul class="nav navbar-nav navbar-left">
            <li ng-show="users.checkLoggedIn()">
              <a href="#" ng-click="trips.getTrips()" ui-sref="viewTrips">View trips</a>
            </li>
          </ul> 
          <ul class="nav navbar-nav navbar-left">
            <li ng-show="users.checkLoggedIn()">
              <a href="#" ng-click="trips.showCreateTripForm()" ui-sref="newTrip">New trip</a>
            </li>
          </ul>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <!-- ui-sref binds the anchor tags to the respective state defined in MainRouter in app.js -->
            <li ng-show="users.checkLoggedIn()">
              <a class="notActive"> Hello {{users.user._doc.local.username}}</a>
            </li>
            <li ng-hide="users.checkLoggedIn()">
              <a href="#" ui-sref="login">Login</a>
            </li>
            <li ng-hide="users.checkLoggedIn()">
              <a href="#" ui-sref="register">Register</a>
            </li>
            <li ng-show="users.checkLoggedIn()">
              <a href="#" ui-sref="home" ng-click="users.logout()">Logout</a>
            </li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
  </header>

    <main class="container" ui-view>
      <a href="#menu-toggle" class="btn btn-default" id="menu-toggle">Add trip</a>
    </main>
  
    <div id="map-canvas"></div>

</div>
</body>
</html>
